# SportowyHub UI Tests

End-to-end tests for the SportowyHub Android app using Appium + NUnit.

## Prerequisites

1. **Node.js** (v18+) — required to install and run Appium
2. **Java JDK** (17+) — required by Android SDK
3. **Android SDK** — with platform tools and at least one system image
4. **.NET 10 SDK**
5. **Android emulator or physical device** — with the app installed

## Setup

### 1. Install Appium

```bash
npm install -g appium
```

### 2. Install the UiAutomator2 driver

```bash
appium driver install uiautomator2
```

### 3. Verify Appium installation

```bash
appium --version
appium driver list --installed
```

You should see `uiautomator2` in the installed drivers list.

### 4. Set up Android environment

Make sure these environment variables are set:

- `ANDROID_HOME` — path to your Android SDK (e.g., `C:\Users\<you>\AppData\Local\Android\Sdk`)
- `JAVA_HOME` — path to your JDK installation

Add `%ANDROID_HOME%\platform-tools` to your `PATH`.

### 5. Deploy the app to the device/emulator

Build and install the app on an Android target:

```bash
cd SportowyHub.App
dotnet build -f net10.0-android -t:Install
```

Or deploy from Visual Studio / Rider to the emulator.

## Running the tests

### 1. Start the Appium server

Open a **separate terminal** and run:

```bash
appium
```

Leave it running. You should see:

```
[Appium] Welcome to Appium v2.x.x
[Appium] Appium REST http interface listener started on http://0.0.0.0:4723
```

### 2. Start the Android emulator (if not using a physical device)

```bash
emulator -avd <your_avd_name>
```

Or start it from Android Studio's Device Manager.

Verify the device is visible:

```bash
adb devices
```

### 3. Run the tests

In a second terminal:

```bash
cd SportowyHub.UITests
dotnet test
```

To run with verbose output:

```bash
dotnet test --logger "console;verbosity=detailed"
```

## Test configuration

Test settings are in `Config/TestConfig.cs`:

| Setting | Default | Description |
|---|---|---|
| `AppiumServerUrl` | `http://127.0.0.1:4723` | Appium server address |
| `PlatformName` | `Android` | Target platform |
| `AutomationName` | `UiAutomator2` | Appium automation driver |
| `AppPackage` | `com.companyname.sportowyhub` | Android app package name |
| `AppActivity` | `crc64e1fb321c08285b90.MainActivity` | Main activity class |
| `DefaultWaitSeconds` | `10` | Implicit wait timeout |
| `ShellRecreationWaitMs` | `3000` | Wait after language/theme change |

## Troubleshooting

### "No connection could be made because the target machine actively refused it"

The Appium server is not running. Start it with `appium` in a separate terminal before running tests.

### "Could not find a connected Android device"

No emulator or device is available. Start an emulator or connect a device, then verify with `adb devices`.

### Tests fail after language/theme change

The app recreates the Shell on language or theme changes. If tests are flaky, try increasing `ShellRecreationWaitMs` in `TestConfig.cs`.

### Wrong `AppActivity`

The activity hash in `AppActivity` is generated by .NET MAUI and may change between builds. To find the correct value:

```bash
adb shell dumpsys activity activities | grep "com.companyname.sportowyhub"
```
